---
layout: post
title: backbone学习记录
category: 技术
tags: Backbone
description: backbone学习之旅
---

### 零散点
模型、视图、集合和路由器是Backbone框架中的主要组件。

## 路由器

### 传统ajax与浏览器历史
ajax是无页面刷新的，页面的url没有办法改变，这样就无法支持浏览器的前进和后退（流量购项目踩了大坑！！！）。
传统的ajax请求有如下问题:  

	1、可以无刷新改变页面内容，但无法改变页面URL(有复制链接给他人的需求等无法实现)
	2、为了更好的可访问性，内容发生改变后，通常改变URL的hash(散列片段)
	3、hash的方式不能很好的处理浏览器的前进、后退等问题
	4、进而浏览器引入了onhashchange的接口，不支持的浏览器只能定时去判断hash是否改变
	5、但这种方式对搜索引擎很不友好
我们可以发现新浪微博的部分区域是无页面刷新的，但是它的**url却可以变化**，实现了浏览器的前进后退，那是因为HTML5里引用了新的API，history.pushState和history.replaceState,他们可以操作浏览器历史，并且改变当前页面的URL.  

[访问](http://www.welefen.com/use-ajax-and-pushstate.html)

### Backbone.Router和Backbone.history
我们回到Backbone提供的路由器。

Backbone 提供一个称为路由器（版本 0.5 前称之为控制器）的组件来路由客户端状态。路由器可以扩展 Backbone.Router 函数，且包含一个散列映射（routes 属性）将状态与活动关联起来。当应用程序达到相关状态(相当于书签)时，会触发一个特定活动。
	
	//示例
	App.Routers.Main = Backbone.Router.extend({
    
   	// Hash maps for routes
   	routes : {
       "" : "index",
       "/teams" : "getTeams",
       "/teams/:country" : "getTeamsCountry",
       "/teams/:country/:name : "getTeam"
       "*error" : "fourOfour"
   	},
   
   	index: function(){
       // Homepage 
   	},
   
   	getTeams: function() {
       // List all teams 
   	},
   	getTeamsCountry: function(country) {
       // Get list of teams for specific country
   	},
   	getTeam: function(country, name) {
       // Get the teams for a specific country and with a specific 		name
   	},	
   	fourOfour: function(error) {
       // 404 page
   	}
	});

当 URL 碰到类似下面情况时，会调用这 5 个活动（index、getTeams、getTeamsCountry、getTeamCountry 和 fourOfour）。  

1. http://www.example.com 触发 index()  
2. http://www.example.com/#/teams 触发 getTeams()  
3. http://www.example.com/#/teams/country1 触发 getTeamsCountry() 传递country1作为参数  
4. http://www.example.com/#/teams/country1/team1 触发 getTeamCountry() 传递 country1 和 team1 作为参数  
5. http://www.example.com/#/something 触发 fourOfour()以作*使用。 
 
要启动 Backbone，先实例化页面加载的路由器，并通过指令 Backbone.history.start() 方法监视散列片段中的任何变更。
	
	//示例
	$(function(){
    	var router = new App.Routers.Main();
    	Backbone.history.start({pushState : true});
	})
	
	//当实例化路由器时，会生成 Backbone.history 对象；它将自动引用 Backbone.History 函数。Backbone.History 负责匹配路由和 router 对象中定义的活动。start() 方法触发后，将创建 Backbone.history 的 fragment 属性。它包含散列片段的值。该序列在根据状态次序管理浏览器历史方面十分有用。用户如果想要返回前一状态，单击浏览器的返回按钮。
	
### 大体感觉
Backbone的路由器,就是为了无刷新页面改变url，支持浏览器的前进后退操作便于历史记录的管理。跟html5提供的history.pushState和history.replaceState接口相关

		

