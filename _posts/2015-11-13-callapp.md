---
layout: post
title: h5唤起app
catgory: 技术
tags: Js
description: callapp的一些测试
---

h5唤起app这种需求是常见的。在移动为王的时代，h5在app导流上发挥着重要的作用。


目前我们采用的唤起方式是url scheme(iOS，Android平台都支持)，只需原生APP开发时注册scheme， 那么用户点击到此类链接时，会自动跳到APP。

### 三种唤起方案

#### iframe

	var last = Date.now(),
    	doc = window.document,
    	ifr = doc.createElement('iframe');

	//创建一个隐藏的iframe
	ifr.src = nativeUrl;
	ifr.style.cssText = 'display:none;border:0;width:0;height:0;';
	doc.body.appendChild(ifr);

	setTimeout(function() {
    	doc.body.removeChild(ifr);
    	//setTimeout回小于2000一般为唤起失败 
    	if (Date.now() - last < 2000) {
        	if (typeof onFail == 'function') {
            	onFail();
        	} else {
            	//弹窗提示或下载处理等
        	}
    	} else {
        	if (typeof onSuccess == 'function') {
            	onSuccess();
        	}
    	}
	}, 1000);
	
iframe方案的唤起原理是: 程序切换到后台时，计时器会被推迟。如果app被唤醒那么网页必然就进入了后台，如果用户从app切回来，那么时间一般会超过2s;若app没有被唤起，那么网页不会进入后台，setTimeout基本准时触发，那么时间不会超过2s。
	
#### window.location.href直接跳转

	window.location.href = nativeUrl;

#### a标签唤起

	<a href="nativeUrl">唤起app</a>


### 三种唤起方案的浏览器测试

	。X表示唤起失败，√表示唤起成功
	。红色标记表示进入页面直接唤起，绿色表示事件操作后唤起
	。ios测试机:iphone 6p;android测试机:小米1s
	
#### iframe唤起app测试结果

![图片显示](/echo-blog/public/img/2015-11-13-iframe.png)

#### window.location.href唤起app测试结果
	

![图片显示](/echo-blog/public/img/2015-11-13-href.png)

#### a标签唤起app测试结果


![图片显示](/echo-blog/public/img/2015-11-13-a.png)

#### iframe和window.location.href唤起对比

![图片显示](/echo-blog/public/img/2015-11-13-iframe-href.png)

#### iframe、window.location.href和a标签唤起三者对比

![图片显示](/echo-blog/public/img/2015-11-13-iframe-href-a.png)







### 参考链接
[从浏览器或者Webview 中唤醒APP](http://blog.html5funny.com/2015/06/19/open-app-from-mobile-web-browser-or-webview/)